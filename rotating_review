#include <Stepper.h>
#include <SoftwareSerial.h>
#define rxPin 2
#define txPin 3
const int SPR = 200;
char x,y,z;
int i=10,j=20,k=30 ;
int go=0;
char color[4]={'r','g','b','y'};


SoftwareSerial xbee =  SoftwareSerial(rxPin, txPin);
Stepper myStepper(SPR, 8, 9, 10, 11);


void alter(int a)      //Function to change the array after each rotation
{
  char Modified[4]; 
 int temp=0,z=0;   
     for(z=0;z<4;z++)     
     { if(a>3)                
       a=0;                   
       if(temp>3)               
       temp=0;       
       Modified[a]=color[temp];
       a++;
       temp++;         
     } 
    for(z=0;z<4;z++)
     color[z]=Modified[z]; 
}


void setup() {
  // put your setup code here, to run once:
 pinMode(rxPin, INPUT);
 pinMode(txPin, OUTPUT);
 xbee.begin(9600);
 Serial.begin(9600);
 Serial.println("Starting XBee Comunication");
}
 
void loop () {
 myStepper.setSpeed(20); 
   
   x=(xbee.read());
   
     switch(x)
      { case 'm' : i=0;
        break;
        case 'n' : i=1;
        break;
        case 'o' : i=2;
        break;
        default : i=9; 
      }  

          y=(xbee.read());
  
          if(y==color[0])
            j=1;
          else if(y==color[1])
            j=2;
          else if(y==color[2])
            j=3;
          else if(y==color[3])
            j=4;
          else
            j=9; 
      
  k=i+j; 
 
//Serial.println(k);
         
          switch(k)
          {  case 1:{go=SPR/4;
                     alter(1); }
              break;
             case 2:{go=SPR/2;
                     alter(2);}
              break;
             case 3:{go=SPR*0.75;
                     alter(3);}
              break;
             case 4:{go=SPR*0;
                     alter(0);}
              break;
             case 5:{go=SPR/4;
                     alter(1);}
              break;
             case 6:{go=SPR/2;
                     alter(2);}
              break;
             default: go=SPR*0;
            
            }
  if(k<8)           
  myStepper.step(-(go*1.2));
  else
   myStepper.step(0);
  
  z=(xbee.read());
  if(z=='p')
   xbee.write('p');
  if(z=='d')
   xbee.write('d');   
        
}
